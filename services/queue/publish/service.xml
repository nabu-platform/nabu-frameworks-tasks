<sequence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		disabled="false"
		id="52726d36-9a6c-471d-a152-82fe0ebd47b4">
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="If no transaction is given, we want to use the default transaction"
			disabled="true"
			id="da207ea8-963d-4c75-87d2-46daa7933eb7"
			label="input/transactionId = null">
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="8e3babcf-5294-4d8a-935e-80e41991dfca"
				mask="false"
				optional="false"
				fixedValue="true">
			<from>true</from>
			<to>manage</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="14d20b61-6bfc-401d-a5da-4e51346d1513"
				serviceId="nabu.utils.Transaction.start"
				resultName="result5061d92f1c7f4588a566e41928d678d0"
				temporaryMapping="true"
				x="29"
				y="52"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="98d5049a-4669-499a-b3ba-82ed2833dfb6"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result5061d92f1c7f4588a566e41928d678d0/transactionId</from>
			<to>input/transactionId</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
			comment="If no queue is given, we create a queue for the context"
			disabled="false"
			id="e677cef8-af4c-41a6-8bad-01d3fca50ebc"
			label="input/queue = null">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Get queue from context if it already exists"
				disabled="false"
				id="8d1fadb7-645f-41b8-8c62-be58eab1ccc6">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="b1985a39-2fc0-4acf-bb50-9e3c677805e6"
					serviceId="nabu.utils.Runtime.getContext"
					resultName="result4192b002b3bc40c9876b67874377e995"
					temporaryMapping="true"
					x="21"
					y="82"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="6ee01434-3e52-480b-bf95-80e708b4c127"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>generated-queue</from>
					<to>key</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="40adc07e-48d5-47ce-b3a9-479e2032610a"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result4192b002b3bc40c9876b67874377e995/value</from>
				<to>input/queue</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="Generate a new queue if it doesn't exist in context"
				disabled="false"
				id="b0268675-40a0-4d6d-a9b7-6db4c11bd1b5"
				label="input/queue = null">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Generate UUID"
					disabled="false"
					id="1ae865f2-3a62-4a89-bfc7-851ca4f813dd">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="ca361e49-1914-4db1-b07a-5cb82867f578"
						serviceId="nabu.utils.Server.uuid"
						resultName="resultdc7a5b148b5a48a0ae60d204c0c106c9"
						temporaryMapping="true"
						x="26"
						y="95"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="866eeac2-6501-4ed1-af62-3fa56ed176ee"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resultdc7a5b148b5a48a0ae60d204c0c106c9/uuid</from>
					<to>input/queue</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="f1afb57f-f049-4f5e-ae02-b699500483a3"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>closeQueue</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="06dd9651-149e-4749-aba3-f6fa5aeb3605"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>anonymous</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="2aaf6bee-5c86-4ce2-badd-108a800d0d96"
						serviceId="nabu.utils.Runtime.getService"
						resultName="result2359dfc70d9b40a8b1bf2af1cec75c15"
						temporaryMapping="true"
						x="68"
						y="249"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="6ba99998-e204-4bd2-b523-75f64403c102"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>2</from>
						<to>offset</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="fa49d750-aa50-4165-9bea-76f9b8e20b85"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result2359dfc70d9b40a8b1bf2af1cec75c15/service</from>
					<to>rootService</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="43c841c5-46d7-4417-901e-db805137b5fc"
						serviceId="nabu.utils.Runtime.getServices"
						resultName="result1a6b43ee189245a6869c36fdcaf3c80b"
						temporaryMapping="true"
						x="103"
						y="161"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="a9986e12-cd9d-4359-bb4f-2bf9e752138d"
						serviceId="nabu.utils.List.reverse"
						resultName="result40e548b3b6164f14a531fda0d0cb21ff"
						temporaryMapping="true"
						x="403"
						y="196"
						invocationOrder="1"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="80f87325-ba97-4989-9c2f-c3f0a206f50a"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result1a6b43ee189245a6869c36fdcaf3c80b/services</from>
						<to>list</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="45d3e939-d792-4a44-af8a-f292b73cec86"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result40e548b3b6164f14a531fda0d0cb21ff/list</from>
					<to>services</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.For"
					disabled="false"
					id="c9d4cd27-9858-4eb2-8fe0-b0cbfd1cebff"
					variable="singleService">
				<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
						disabled="false"
						id="1ad2b71c-2995-45f5-b1d4-ceb659a871c8"
						label="singleService !~ &quot;^nabu\..*&quot;">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="Map the service name"
							disabled="false"
							id="88888307-48d7-417a-95ec-54a24bfebe04">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="e220eb72-30d6-4e6c-b722-08af39999680"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>singleService</from>
							<to>rootService</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Break"
							disabled="false"
							id="52177b1b-0713-4e22-b827-0db1fd6ff675">
						<count>1</count>
					</steps>
				</steps>
				<query>services</query>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="50e5d2d1-d033-4401-a2ab-8841fac47ba5"
					label="rootService = null">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="204250c0-13f0-4092-84b5-dc6680cbf272"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>~generated</from>
					<to>rootService</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Prepend queue name"
					disabled="false"
					id="62aa7cf3d55c40898315cbeb78bcd287">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="030c641b-10d0-4489-a183-fee341abcd47"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>=rootService + ":" + input/queue</from>
					<to>input/queue</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Set it in the context"
					disabled="false"
					id="1fa4d9f1aff34e0688e5409e0dce9927">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="28aa5d6d46e641e9a3b41ea25bf49217"
						serviceId="nabu.utils.Runtime.setContext"
						resultName="result77d4cb9d266447b087521a227fcbc004"
						temporaryMapping="true"
						x="178"
						y="210"
						invocationOrder="1"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="696f9daf86e045528e641c8342b63477"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>generated-queue</from>
						<to>key</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="e186df26-469d-4144-92ab-bdbcada84bbe"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>input/queue</from>
						<to>value</to>
					</steps>
				</steps>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="0e16e024-f589-4fc4-b9e6-9ebf6d5f0da6">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="c5cca801-68fa-4733-afe9-7cf6c0df2c2b"
				serviceId="nabu.frameworks.tasks.database.taskQueue.selectByName"
				resultName="result397e8b4b821949829c97793449a6864f"
				temporaryMapping="true"
				x="39"
				y="59"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="cd5a7dac-83ea-4693-8d39-33964e7baa59"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/queue</from>
				<to>parameters/name</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="d9f06896-4237-4d3e-8739-0932e93907c7"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/connectionId</from>
				<to>connection</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="27908261-6b86-4226-b203-8e7c48cb3574"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/transactionId</from>
				<to>transaction</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="13434ab8-5d6c-4aa1-89c2-c9c4dcd87c3e"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result397e8b4b821949829c97793449a6864f/results[0]</from>
			<to>queue</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="If the queue does not exist, we create it serially. Note that through context you can set a queue dependency"
			disabled="false"
			id="d31a05be-06b0-4c8e-b1b3-8b22db49835f"
			label="!queue">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="f353f017-9afc-49bf-a276-f0f16000814b"
				serviceId="nabu.frameworks.tasks.services.queue.create"
				resultName="result95af1368b8544270b1c6d19354323451"
				temporaryMapping="true"
				x="190"
				y="144"
				invocationOrder="1"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="6eede879-49aa-445d-b135-3dcdbc4bb0c6"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result510e73f6c82f4e8f91978170a5ae968b/value</from>
				<to>queue/dependencyId</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="9bef8f26-dd0a-4c21-a699-7dab55a687e5"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/queue</from>
				<to>queue/name</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="1791dbb1-df30-42d1-88b8-912c277e4e2f"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/connectionId</from>
				<to>connectionId</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="71cdf275-cac1-4dee-98fc-cb42a4ed0fe2"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/transactionId</from>
				<to>transactionId</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="b12f072d-b070-4791-9214-8b28fe4c4b9a"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>anonymous</from>
				<to>queue/anonymous</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="eb7040d0-1803-4b33-8d6e-9812b4dbd269"
				serviceId="nabu.utils.Runtime.getContext"
				resultName="result510e73f6c82f4e8f91978170a5ae968b"
				temporaryMapping="true"
				x="16"
				y="28"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="fd102b27-8338-4e2e-ac2b-08a5adf14751"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>queue-dependency</from>
				<to>key</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="49fbbddc-c26e-405f-ba39-0c498c1e2de4"
				mask="true"
				optional="false"
				fixedValue="false">
			<from>result95af1368b8544270b1c6d19354323451/queue</from>
			<to>queue</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
			disabled="false"
			id="967281c4-bd3e-498f-b225-4e793df4d3ab"
			label="queue/published != null"
			message="=&quot;The queue is closed for publishing&quot;" xsi:nil="true"/>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Register a handler to set it to published once the service is done"
			disabled="false"
			id="2b82864d-322f-416c-a804-03cff95efee3"
			label="closeQueue">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="e909e766-6dd4-49a2-94eb-3ab370141639"
				serviceId="nabu.frameworks.tasks.utils.queue.setPublished"
				resultName="result933f7d54e2c140b3b4a5999d5bcd466a"
				temporaryMapping="true"
				x="103"
				y="84"
				invocationOrder="0"
				target="nabu.utils.providers.onTransactionClose"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="df23772d-bb24-4e59-945c-199c47f4fbc5"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/connectionId</from>
				<to>connectionId</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="3cfb41de-8c10-4c5b-9afd-ff703f786e6b"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>queue/id</from>
				<to>queueId</to>
			</steps>
			<targetProperties
					collectionIndex="onCommit">true</targetProperties>
			<targetProperties
					collectionIndex="onRollback">true</targetProperties>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Map initial"
			disabled="false"
			id="37ca58e5-fa4c-4d95-9a05-593694bfb2da">
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="d70d0f90-ddc9-4e1d-b0ab-9c0a097b4e32"
				mask="true"
				optional="false"
				fixedValue="false">
			<from>input/task</from>
			<to>task</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Map rest"
			disabled="false"
			id="b487be46-765a-4df7-bbf0-e94e7e45e2a6">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="757ad412-7e79-4569-abe6-7808a9b4463e"
				serviceId="nabu.utils.Server.getServerName"
				resultName="resulte772e3473074466985e65c04e58e2c60"
				temporaryMapping="true"
				x="266"
				y="254"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="361916da-f87f-43b7-ab23-49cc45ceb471"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resulte772e3473074466985e65c04e58e2c60/server</from>
			<to>task/creator</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="988135cd-fe06-469c-aca0-e85eb7d2c9e8"
				serviceId="nabu.utils.Date.now"
				resultName="result7dc15ccaffa341149ec45c0c14789874"
				temporaryMapping="true"
				x="211"
				y="151"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="e76ad360-c5d2-415c-aa2f-6eb16b07d579"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result7dc15ccaffa341149ec45c0c14789874/date</from>
			<to>task/created</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="5b57a0a7-b176-4ff2-84a7-f60c68724be7"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result7dc15ccaffa341149ec45c0c14789874/date</from>
			<to>task/modified</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="ab77b495-1292-40f7-9c03-93945159373d"
				serviceId="nabu.utils.Server.uuid"
				resultName="resultc96364e6e951419abb92c1d203414d86"
				temporaryMapping="true"
				x="202"
				y="53"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="6efec1c0-fef0-43e9-879d-2ec409117321"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultc96364e6e951419abb92c1d203414d86/uuid</from>
			<to>task/id</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="480bcc97-f9dd-4e30-b526-c403a8c3e91b"
				mask="false"
				optional="true"
				fixedValue="true">
			<from>$any</from>
			<to>task/target</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="8d21d15b-4b5c-4295-a71c-b419ccc03e31"
				mask="false"
				optional="false"
				fixedValue="true">
			<from>CREATED</from>
			<to>task/state</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="d5ef60ec-13e9-4e8c-928d-2320748a4919"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>queue/id</from>
			<to>task/taskQueueId</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="a39dd7a1-ff87-4e6f-99b6-1170d54bd5b5"
				serviceId="nabu.utils.Runtime.getServiceContext"
				resultName="result68f2ba9defc2467d8e1555abf4dae204"
				temporaryMapping="true"
				x="209"
				y="441"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="19315cef-a8ea-4e97-bf9d-2f8cf1bb9d6a"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result68f2ba9defc2467d8e1555abf4dae204/serviceContext</from>
			<to>task/serviceContext</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="1e8b244d-9fda-4247-8d0d-e1a32a3c5530"
			label="input/stage = true">
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="b40a233b-b618-4bd2-b87a-902879d96917"
				mask="false"
				optional="false"
				fixedValue="true">
			<from>STAGED</from>
			<to>task/state</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="If we have a queue schedule, use it"
			disabled="false"
			id="2a3b9900-85b3-44fd-b977-a82e8a5e9bde"
			label="task/scheduled = null &amp;&amp; queue/schedule != null">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="00e7f064-3cc2-4024-bb91-94e6fda0b3f3"
				serviceId="nabu.frameworks.tasks.services.schedule.parse"
				resultName="resulte844f5ae168341aa9f1207fc46a7dba9"
				temporaryMapping="true"
				x="30"
				y="62"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="1e74531b-3a41-4914-9c29-bce36d29a610"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>queue/schedule</from>
				<to>schedule</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="4a21f7a0-a971-4556-acf7-89f1f6041342"
				serviceId="nabu.frameworks.tasks.services.schedule.next"
				resultName="result295339fcf3e843ee82217650d138467e"
				temporaryMapping="true"
				x="191"
				y="159"
				invocationOrder="1"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="5e1cf14c-2806-4e48-8f7d-cfe9f7f9d77e"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resulte844f5ae168341aa9f1207fc46a7dba9/schedule</from>
				<to>schedule</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="e42c7bce-8a29-478c-9732-234d756e6645"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result295339fcf3e843ee82217650d138467e/nextRun</from>
			<to>task/scheduled</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="c77e24d5-4514-4d75-a82a-f77e37f6c944">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="8e68e6f4-89ff-45f5-b5cc-20f8a984aba3"
				serviceId="nabu.frameworks.tasks.database.task.insert"
				resultName="resultf8b9502f795c4eaeb4a703f2da8f5331"
				temporaryMapping="true"
				x="68"
				y="49"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="b244ef95-100e-480d-96cb-9bfbb0d586c9"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/connectionId</from>
				<to>connection</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="8b0fc8e5-d110-40c9-bbca-87290bc6cce6"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/transactionId</from>
				<to>transaction</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="c5c840e5-eb56-4f20-87d2-6fc508a4dd0c"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>task</from>
				<to>parameters[0]</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="7654137e-2dda-4490-b933-ef9d015b5ab4"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>task/id</from>
			<to>output/taskId</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.For"
			disabled="false"
			id="e23b4bdc-c42c-4d01-a9fd-d69b134ecf1c"
			variable="property">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="Map task property"
				disabled="false"
				id="9c19933f-ae23-4a1e-8e7e-98f34676b700">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="bd6cfe0a-ef26-4de7-8771-2ae7f5564038"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>property/key</from>
				<to>taskProperty/key</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="67a499ef-14e3-44f5-9e4e-bc8ada03ae33"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>property/value</from>
				<to>taskProperty/value</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="2f61577d-599e-402c-a541-5dd8795a7d4f"
					serviceId="nabu.utils.Server.uuid"
					resultName="result2418f3c8973145c18956c34d6f3f0fca"
					temporaryMapping="true"
					x="36"
					y="40"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="72b3d919-6d6d-48e2-9b79-dfaa9f462464"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>result2418f3c8973145c18956c34d6f3f0fca/uuid</from>
				<to>taskProperty/id</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="e53bcfb7-b4af-4b70-a524-85c0482a08fa"
					serviceId="nabu.utils.Date.now"
					resultName="resulteaefbd271e8d4237ae0c04c21f83c3ce"
					temporaryMapping="true"
					x="27"
					y="124"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="bd373df3-0cf5-49c1-b232-ff4f25f8f79f"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resulteaefbd271e8d4237ae0c04c21f83c3ce/date</from>
				<to>taskProperty/created</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="44348451-4ee9-4c6a-91af-962f2d391c7f"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resulteaefbd271e8d4237ae0c04c21f83c3ce/date</from>
				<to>taskProperty/modified</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="0d89cf59-1d9c-423c-90d2-621e9f2ed95b"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>task/id</from>
				<to>taskProperty/taskId</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="d5fad15b-db9d-49b6-b9f4-7ff8e9d7e8f0">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="61925140-f3c0-4999-994a-41cff66c9514"
					serviceId="nabu.utils.List.add"
					resultName="resultc431cd49b1864b65bb36d5cb0a347fa2"
					temporaryMapping="true"
					x="23"
					y="66"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="c0b5ec6e-b859-4afe-8ae6-75631f93e4ee"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>taskProperty</from>
					<to>object</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="5077118b-3fe6-40e3-910a-96b02679bec7"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>taskProperties</from>
					<to>list</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="7ad4d005-746e-419a-a83f-770780763b52"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>resultc431cd49b1864b65bb36d5cb0a347fa2/list</from>
				<to>taskProperties</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
					disabled="false"
					id="bd931146-8761-4308-8107-b1ebdc82cb95"
					path="taskProperty" xsi:nil="true"/>
		</steps>
		<query>input/properties</query>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="125c3526-0cb6-4e4d-a168-49fd3ee6fd08"
			label="taskProperties">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="53f26182-572d-4528-aad7-09fd0e0e076b"
				serviceId="nabu.services.jdbc.Services.insert"
				resultName="result5e93e0c1513147389f78f2ee973014eb"
				temporaryMapping="true"
				x="125"
				y="100"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="18ee7d87-e3ec-4a9c-99da-21037ba9b637"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/connectionId</from>
				<to>connection</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="5b8a067e-0cee-4ba6-befe-74e9891aee83"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/transactionId</from>
				<to>transaction</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="54524211-1120-4025-8d9c-fc7d08646304"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>taskProperties</from>
				<to>instances</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="f2646543-b8ab-4322-a13d-23056cbbaeac"
			label="manage">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="bc5c5f0e-6474-4588-aee6-14541c01669e"
				serviceId="nabu.utils.Transaction.commit"
				resultName="resultb5de570bbfa946bdbb7a796c779d9465"
				temporaryMapping="true"
				x="66"
				y="66"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="d35c56ac-7739-4bf8-88b8-bb87a86cca85"
					mask="false"
					optional="false"
					fixedValue="false">
				<from>input/transactionId</from>
				<to>transactionId</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
			comment="Wake up the task checker if necessary"
			disabled="false"
			id="490841ff-a580-4fa0-b224-09aafb1e427f"
			label="input/wakeup"
			query="manage">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				comment="If managed, the task is now available (transaction committed), wake up immediately"
				disabled="false"
				id="4727453b-e2bf-4d43-bae8-13868911b73b"
				label="true">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="aaefcc8c-885f-480b-8f17-80ac7327a591"
					serviceId="nabu.frameworks.tasks.services.poller.wakeup"
					resultName="resultca9e89f0f3be4f0cbc66e40e4838e6b4"
					temporaryMapping="true"
					x="64"
					y="76"
					invocationOrder="0"
					target="nabu.utils.providers.onTransactionClose"
					asynchronous="false"
					recache="false">
				<targetProperties
						collectionIndex="onCommit">true</targetProperties>
				<targetProperties
						collectionIndex="onRollback">false</targetProperties>
				<targetProperties
						collectionIndex="transactionId">=input/transactionId</targetProperties>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="a6c11b9b-adbd-4e04-bc88-7c1cc2e7d3f8">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="5f1efab6-9636-4d26-ba1b-c0ba54d2fa17"
					serviceId="nabu.utils.providers.onTransactionClose"
					resultName="resultf2ad5174cfa84fd5bf563bc2d2b5fba5"
					temporaryMapping="true"
					x="123"
					y="46"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="eae79fdc-e234-451e-a132-7e2f0c67cef3"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>nabu.frameworks.tasks.services.poller.wakeup</from>
					<to>serviceId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="a3bbde8b-7a2b-4cf7-a5b6-368f8fa21fdd"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/transactionId</from>
					<to>transactionId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="48b703b1-6843-49c3-99e5-b6364c06b00f"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>true</from>
					<to>onCommit</to>
				</steps>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Catch"
			disabled="false"
			id="b2a455da-3c0f-4777-b462-2a2c29945b61"
			variable="exception">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="2b0819a8277e40df8f0faaefbb689e69"
				label="manage">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="19411fd4-b5a0-490f-9ce4-a3abfee1158c"
					serviceId="nabu.utils.Transaction.rollback"
					resultName="result929732ee1d7445c4ac10a67717aa7017"
					temporaryMapping="true"
					x="22"
					y="23"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="59dbb8cb-9569-40a3-85a4-462181040d52"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>input/transactionId</from>
					<to>transactionId</to>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Throw"
				disabled="false"
				id="3c30a983-c6ce-4d88-9a50-9e79c602483e"
				message="=exception" xsi:nil="true"/>
	</steps>
</sequence>