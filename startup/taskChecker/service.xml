<sequence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		disabled="false"
		id="12d482e4-212a-4414-b7f7-7ab3955fe592"
		lineNumber="1">
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			comment="Get task providers"
			disabled="false"
			id="43efc0d8-a4a3-437f-9a7f-c566302402f8"
			lineNumber="2">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="4d361866-0c61-4822-919d-8003c3914293"
				serviceId="nabu.utils.Server.getServerName"
				resultName="result9544cc91a51c401e84a7fab61403982c"
				temporaryMapping="true"
				x="50"
				y="196"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="d72e8f58-cec0-40c7-a80a-bfde9b2c4611"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result9544cc91a51c401e84a7fab61403982c/server</from>
			<to>server</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="bef2304f-acc9-47f8-a457-a4ead66db59c"
				serviceId="nabu.frameworks.tasks.utils.misc.getTaskProviders"
				resultName="result29286720901f4b59a3c81811686772d4"
				temporaryMapping="true"
				x="178"
				y="53"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="6b8812bc-0af1-405b-bb28-e8c456db2fd9"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>result29286720901f4b59a3c81811686772d4/providers</from>
			<to>taskProviders</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="064c0954-5758-4548-8dd5-74630965b872"
				serviceId="nabu.utils.Server.property"
				resultName="resultf9b3b856afc349c0beadf90a26136d66"
				temporaryMapping="true"
				x="86"
				y="272"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="0ac6ac8f-0b73-4ee2-9343-a1c662771504"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>development</from>
				<to>key</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link"
					disabled="false"
					id="6d5619f7-0611-46c1-8b02-b3b46d769de8"
					mask="false"
					optional="false"
					fixedValue="true">
				<from>false</from>
				<to>defaultValue</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="5498e790-4694-426d-adea-becc3925d3e1"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultf9b3b856afc349c0beadf90a26136d66/value</from>
			<to>developmentMode</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
			comment="Do initial rollback for this server, we have either restarted the server or the startup service"
			disabled="false"
			id="dc417e5e-b119-4c24-8611-b54994ef4495"
			lineNumber="3"
			transactionVariable="transactionId">
		<steps xsi:type="be.nabu.libs.services.vm.step.For"
				disabled="false"
				id="40a06a8e-d1c7-411b-94ab-5ed056423017"
				lineNumber="4"
				variable="taskProvider">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="b1e7fa4c-7ccd-4e7b-a0f9-2c70a9da0a43"
					lineNumber="5">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="038fc46a-a7e7-4a6d-be63-2070141347dc"
						serviceId="nabu.frameworks.tasks.services.queue.list"
						resultName="resultd2ab92e9b81648a485e943f398691b58"
						temporaryMapping="true"
						x="57"
						y="93"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="cb272fbf-e25e-46fd-989f-78d67da4f55b"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>taskProvider/connectionId</from>
						<to>connectionId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="0e68dfa3-6bdf-48c1-98ce-fb4618546dfa"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>taskProvider/targets</from>
						<to>targets</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="ac428855-bf74-4816-819e-c153ae51c15e"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>transactionId</from>
						<to>transactionId</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="fdd2fbe6-a0e6-4c45-9c0a-98d9570ac682"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resultd2ab92e9b81648a485e943f398691b58/queues</from>
					<to>queues</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.For"
					disabled="false"
					id="e0c98a99-52d6-440b-8d90-386c61a3afcc"
					lineNumber="6"
					variable="queue">
				<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
						comment="We want to commit rollbacks per connection. Otherwise if multiple connections point to the same task tables, they can deadlock each other."
						disabled="false"
						id="fab3e83d-ca17-4421-a659-a3a499836728"
						lineNumber="7"
						transactionVariable="localTransactionId">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							disabled="false"
							id="0f9c0295-5f1a-45a7-9388-5af7711b6fa9"
							lineNumber="8">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="cc7b7554-21b2-4ad3-9b96-803afa3cca1d"
								serviceId="nabu.frameworks.tasks.utils.queue.rollback"
								resultName="result905641bedf124b3ca4bdad9bbc342fc2"
								temporaryMapping="true"
								x="57"
								y="69"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="855e7e2a-50b7-42cd-8eaa-d3f302b4a21b"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>server</from>
								<to>owner</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="05f50edf-018c-4ffc-88d2-e92e3b60253b"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>queue</from>
								<to>queue</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="1385884c-83be-4c1c-866e-4c99a4b73c5c"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>taskProvider/connectionId</from>
								<to>connectionId</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="e82074b7-b84a-487f-b55b-0e3203653779"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>localTransactionId</from>
								<to>transactionId</to>
							</steps>
						</steps>
					</steps>
				</steps>
				<query>queues</query>
			</steps>
			<query>taskProviders[connectionId != null]</query>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.For"
			disabled="false"
			id="ae9cd2d5-b9af-42cf-b30d-fc320f1bc17b"
			lineNumber="9">
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="Subscribe"
				disabled="false"
				id="ed362d55-a31b-44b2-bb7a-e3fc2b205dbb"
				lineNumber="10"
				transactionVariable="transactionId">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Check if someone interrupted us while we were sleeping, this clears the flag"
					disabled="false"
					id="248a5f97-3b78-4966-aa3d-4f250e3dc7e6"
					lineNumber="11">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="587f613e-2ce0-4b95-8af9-802083fb31b8"
						serviceId="nabu.utils.Runtime.interrupted"
						resultName="result9c4dc6ef4c604920a32c7ae1cb6541b3"
						temporaryMapping="true"
						x="63"
						y="92"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="99f181e3-7e95-4759-88ca-03a0938e8ed4"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>nabu.frameworks.tasks.artifacts.taskChecker</from>
						<to>artifactId</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="4ac4db52-5293-4a28-a912-7f16ccf483f2"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result9c4dc6ef4c604920a32c7ae1cb6541b3/interrupted</from>
					<to>interrupted</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
						disabled="false"
						id="52e726dc-d993-449b-ab8c-d7c9dc24d944"
						path="queuesToCheck" xsi:nil="true"/>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.For"
					disabled="false"
					id="1d274508-c5a3-4599-b08b-03422a8b1130"
					lineNumber="12"
					variable="taskProvider">
				<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
						disabled="false"
						id="b2444f38-855f-425b-a756-9af7dd86e924"
						lineNumber="13">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="Get queues and &quot;now&quot; for comparison"
							disabled="false"
							id="b83807a2-0a83-4e70-aed3-f07e4f258f90"
							lineNumber="14">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="6854aa94-aa20-411a-b90e-54fcf651965a"
								serviceId="nabu.frameworks.tasks.services.queue.list"
								resultName="resultc25edaf054d84381bd2950f9be8ff506"
								temporaryMapping="true"
								x="72"
								y="92"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="a9599156-13a9-46a4-a206-112f6f116929"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>taskProvider/connectionId</from>
								<to>connectionId</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="b4444757-fd16-4837-b55a-cb61f7a21740"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>transactionId</from>
								<to>transactionId</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="1884cbea-aa11-4fee-9891-0f005f19602d"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>resultc25edaf054d84381bd2950f9be8ff506/queues</from>
							<to>queues</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="9ac2c931-9168-42f4-b32a-8f0cdf612b5f"
								serviceId="nabu.utils.Date.now"
								resultName="result33d5cc32c2a241349fb3cb7fed1314e2"
								temporaryMapping="true"
								x="106"
								y="188"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="14ca4a67-14c0-435d-9a49-f27d7d98bde8"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result33d5cc32c2a241349fb3cb7fed1314e2/date</from>
							<to>now</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.For"
							disabled="false"
							id="9c482831-1860-4cd7-8c40-df02eaea9d68"
							lineNumber="15"
							variable="queue">
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								comment="Subscribe"
								disabled="false"
								id="f2d771d0-b986-4201-917a-1961694caff2"
								lineNumber="16">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="b33eebba-a5a5-4686-8265-8444db64fdd2"
									serviceId="nabu.frameworks.tasks.utils.queue.subscribe"
									resultName="resultb3cf228863434d8f8b7d63cdfcb0e951"
									temporaryMapping="true"
									x="75"
									y="55"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="48cea6cf-9c06-4f18-a846-6176a0804126"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>transactionId</from>
									<to>transactionId</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="4f6e34e1-8d61-48c5-886c-f8161e69507c"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>taskProvider/connectionId</from>
									<to>connectionId</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="7e7dab1f-dd12-420b-9292-84883d92e7b3"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>taskProvider/targets</from>
									<to>targets</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="d06cb1df-6dac-471b-aa4a-f29d1fa43772"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>queue</from>
									<to>queue</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="ec47e361-d010-4952-82f2-cf3db4f3d9de"
										mask="false"
										optional="false"
										fixedValue="true">
									<from>service</from>
									<to>taskType</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="4d1a4736-a4ab-48ad-9628-bdaa6737ffa8"
									serviceId="nabu.utils.List.size"
									resultName="resultd9be071d703b41cfa9fd9c4c6564a8ac"
									temporaryMapping="true"
									x="173"
									y="190"
									invocationOrder="1"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="ed789b58-50d2-447f-86d8-4d0260a1b941"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>resultb3cf228863434d8f8b7d63cdfcb0e951/tasks</from>
									<to>list</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="578654e2-f907-4544-aa5f-f4b24aa0caf4"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>resultd9be071d703b41cfa9fd9c4c6564a8ac/size</from>
								<to>amountOfTasks</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								disabled="false"
								id="b65381b7-b264-489c-858e-040bdf9a8aea"
								label="amountOfTasks &gt; 0"
								lineNumber="17">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="237d9a0a-9b0a-4b13-b847-08a1e4c11b6d"
									serviceId="nabu.utils.Server.log"
									resultName="result80b2fed9e05d44b1b290c7b54f44c43f"
									temporaryMapping="true"
									x="62"
									y="82"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="61f55002-4043-4cc2-b2d9-bb1ca9d9e04e"
										mask="false"
										optional="false"
										fixedValue="true">
									<from>="Subscribed " + amountOfTasks + " tasks for queue '" + queue/name + "'"</from>
									<to>message</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="6ccee66d-3de8-4cec-8a92-bb0d321a4f72"
										mask="false"
										optional="false"
										fixedValue="true">
									<from>DEBUG</from>
									<to>level</to>
								</steps>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
								comment="Add it to the list of queues to check for finalization"
								disabled="false"
								id="cc6a4c64-e17c-45fd-9af9-adf56f84cc2a"
								label="amountOfTasks = 0 &amp;&amp; queue/published != null"
								lineNumber="18">
							<steps xsi:type="be.nabu.libs.services.vm.step.Map"
									comment="Map the queue to check"
									disabled="false"
									id="86a4f658-a241-4a1d-bad1-13cf50bf205d"
									lineNumber="19">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="dc7f1cea-8b3b-4912-8db8-b7bfe84b0626"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>taskProvider</from>
									<to>queueToCheck/provider</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="8575e2bc-0922-4374-9f2b-d1774b0100c7"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>queue</from>
									<to>queueToCheck/queue</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Map"
									disabled="false"
									id="6af229fe-ceb7-487f-b3f3-8a892765195b"
									lineNumber="20">
								<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
										disabled="false"
										id="502b419a-d004-45ef-aea9-464d7870ea81"
										serviceId="nabu.utils.List.add"
										resultName="resultff6e7baf678b4c7b83c0bfc29419cc56"
										temporaryMapping="true"
										x="9"
										y="155"
										invocationOrder="0"
										asynchronous="false"
										recache="false">
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="7a782827-f056-41d1-9c16-2e5a614eda24"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>queuesToCheck</from>
										<to>list</to>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="cb023ccc-6d16-46b3-84dd-4fcb33ce4466"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>queueToCheck</from>
										<to>object</to>
									</steps>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="6e1d1c7b-f61c-43e7-bb26-85ba9955e1e9"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>resultff6e7baf678b4c7b83c0bfc29419cc56/list</from>
									<to>queuesToCheck</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
										disabled="false"
										id="bb6751d3-3322-4b4c-b13b-8798e9ab5a04"
										path="queueToCheck" xsi:nil="true"/>
							</steps>
						</steps>
						<query>queues</query>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="Select the nearest scheduled (if any)"
							disabled="false"
							id="b7b92f75-4bb7-4e2a-8ccf-26b9267d6b7c"
							lineNumber="21">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="5f508dec-35e9-4c48-ac3b-c7653474f192"
								serviceId="nabu.frameworks.tasks.utils.task.next"
								resultName="resultb8920274ced14cf582b53633da148e8d"
								temporaryMapping="true"
								x="92"
								y="49"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="b8e58b22-43f5-4bcc-bd03-98213e80174e"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>taskProvider/connectionId</from>
								<to>connectionId</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="7977a2c4-5522-4fd0-a584-aaac77679acf"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>transactionId</from>
								<to>transactionId</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="c0e798dc-e93e-4347-a17f-dade53b43f23"
									mask="false"
									optional="false"
									fixedValue="true">
								<from>CREATED</from>
								<to>states[0]</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="b2ddf24c-2306-4686-976f-b8cd8158d6ab"
									mask="false"
									optional="false"
									fixedValue="true">
								<from>service</from>
								<to>taskType</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="95baf8df-8fda-4c52-a32f-3339610fbc8c"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>taskProvider/targets</from>
								<to>targets</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="9691e903-3c56-434a-be20-98e15fb10f5f"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>resultb8920274ced14cf582b53633da148e8d/scheduled</from>
							<to>scheduled</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="Use the scheduled task for sleeping."
							disabled="false"
							id="5af8a805-e3ee-4003-b301-a482df67263c"
							label="scheduled != null &amp;&amp; scheduled &gt; now &amp;&amp; (nearestSchedule = null || scheduled &lt; nearestSchedule)"
							lineNumber="22">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="43c3b033-1e46-4ada-8104-52075b1f0481"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>scheduled</from>
							<to>nearestSchedule</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="We might not have enough resources to process all the tasks, log it"
							disabled="false"
							id="ac280e4f-a154-4e29-a163-f4607b0d4f40"
							label="scheduled != null &amp;&amp; scheduled &lt;= now"
							lineNumber="23">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="3af74e92-1f0d-40c9-96d6-70fe0bb66a6a"
								serviceId="nabu.utils.Server.log"
								resultName="result89f31a5daa7a4f9b919323cdf26af44b"
								temporaryMapping="true"
								x="74"
								y="17"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="8bfb09ea-41bd-4831-82b4-5f09230e58d3"
									mask="false"
									optional="false"
									fixedValue="true">
								<from>Not enough resources to process all scheduled tasks</from>
								<to>message</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="77542e14-8f10-4003-8be6-e61dec94b127"
									mask="false"
									optional="false"
									fixedValue="true">
								<from>WARN</from>
								<to>level</to>
							</steps>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Catch"
							comment="If anything fails, we remove the task provider, it will likely continue failing"
							disabled="false"
							id="41db530b-0f34-4dc4-85bc-b26bbc48d238"
							lineNumber="24"
							variable="queueException">
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								comment="Send event"
								disabled="false"
								id="92de790e-e06b-496c-a57a-deea9aca0af3"
								lineNumber="25">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="176e49d5-4c35-4c7a-8404-0a4b421c96a9"
									serviceId="nabu.utils.Event.create"
									resultName="result28ea1c5f45f14841811fe69e99435b5b"
									temporaryMapping="true"
									x="471"
									y="55"
									invocationOrder="1"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="9f4f7c84-25cc-40a2-993a-406a925f9a7d"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>taskProvider/connectionId</from>
									<to>event/artifactId</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="2e2097d5-5365-465c-bb5a-3e2bb9205d7e"
										mask="false"
										optional="false"
										fixedValue="true">
									<from>ERROR</from>
									<to>event/severity</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="166d8ead-4e3d-422b-84f6-228de6737bcb"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>resultd6a08280d8024702a669abf075c83783/summary/exceptionStack</from>
									<to>event/stacktrace</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="4dade912-ea21-4f1f-a1b0-50dcb2b27f14"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>resultd6a08280d8024702a669abf075c83783/summary/coreMessage</from>
									<to>event/message</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="01218c4e-ddef-4e71-a983-c42d1749496a"
										mask="false"
										optional="false"
										fixedValue="true">
									<from>task-check-failed</from>
									<to>event/eventName</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="f7e77b1f-6497-42f8-b81a-7c66de4ca29e"
										mask="false"
										optional="false"
										fixedValue="true">
									<from>task-check</from>
									<to>event/eventCategory</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="011b417c-7e6f-4cf6-b90d-4b30f5aaf69b"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>resultd6a08280d8024702a669abf075c83783/summary/serviceStack</from>
									<to>event/context</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="3f875a77-7d8f-427b-97c9-27d4583bdc7e"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>resultd6a08280d8024702a669abf075c83783/summary/code</from>
									<to>event/code</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="8b69ea19-2e89-4495-956b-8bfe7c8e4f19"
									serviceId="nabu.utils.Runtime.summarizeException"
									resultName="resultd6a08280d8024702a669abf075c83783"
									temporaryMapping="true"
									x="31"
									y="42"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="fbc60158-e4e6-4352-96f6-6f2b70fd603f"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>queueException</from>
									<to>exception</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="cc76f537-d25d-4d81-8c82-61b1775f4321"
									serviceId="nabu.utils.Event.fire"
									resultName="result196bddd657944dd5a1db70bb565acca0"
									temporaryMapping="true"
									x="663"
									y="269"
									invocationOrder="2"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="65928443-cfe2-4c42-b294-3b3c15990e65"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>result28ea1c5f45f14841811fe69e99435b5b/event</from>
									<to>event</to>
								</steps>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								comment="Add to the list to remove"
								disabled="false"
								id="58a9b4b2-8970-4928-af9c-ea5c9f00ee4d"
								lineNumber="26">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="87561abd-ddb1-4716-9755-a9eded5591f0"
									serviceId="nabu.utils.List.add"
									resultName="result53179bd2484b4dd9aee89a33ad44207b"
									temporaryMapping="true"
									x="80"
									y="141"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="e918aa5e-7a4c-4491-9e56-ecb5c36a5f99"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>taskProvidersToRemove</from>
									<to>list</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="09b82359-b08e-4e8b-a38a-25b08c20f905"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>taskProvider</from>
									<to>object</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="fabb1e3c-1c03-4e3c-a596-24bc7e5384b9"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>result53179bd2484b4dd9aee89a33ad44207b/list</from>
								<to>taskProvidersToRemove</to>
							</steps>
						</steps>
					</steps>
				</steps>
				<query>taskProviders[connectionId != null]</query>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
					disabled="false"
					id="f91342d4-9d35-416e-a3e6-8604d155d83c"
					label="taskProvidersToRemove"
					lineNumber="27"
					query="developmentMode">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Remove any failing"
						disabled="false"
						id="372857d3-4ab1-4f6c-af01-2caae539d296"
						label="true"
						lineNumber="28">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="96f12a75-315a-407d-aa59-bec4ca042752"
							serviceId="nabu.utils.List.removeAll"
							resultName="result6714bf63799b4882bebe114564bbe52a"
							temporaryMapping="true"
							x="99"
							y="190"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="80e28ecc-1576-471b-bec7-d6c066ece076"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>taskProvidersToRemove</from>
							<to>objects</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="98a83968-9308-4995-b41f-13179d95d035"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>taskProviders</from>
							<to>list</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="4e15c4c9-4d90-4860-9c7b-a9a819b21edc"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result6714bf63799b4882bebe114564bbe52a/list</from>
						<to>taskProviders</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
							disabled="false"
							id="7a193255-d9b3-44e7-8a6f-e3ac83fb41e6"
							path="taskProvidersToRemove" xsi:nil="true"/>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="We keep the failing, hoping that it is a transient error"
						disabled="false"
						id="c7c6c762-0b20-4d68-ad1a-55123a539cbf"
						lineNumber="29">
					<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
							disabled="false"
							id="bf4a2c8e-39a6-4287-ad00-7cdd724c6ca8"
							path="taskProvidersToRemove" xsi:nil="true"/>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Catch"
					disabled="false"
					id="8477c65f-2575-4210-9de3-a5c6055a476a"
					lineNumber="30">
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="Finalize"
				disabled="false"
				id="ae8d4c24-15c5-4515-86d0-0e097a6f0e3b"
				label="queuesToCheck"
				lineNumber="31"
				transactionVariable="transactionId">
			<steps xsi:type="be.nabu.libs.services.vm.step.For"
					disabled="false"
					id="a555eb8d-ab7e-4c20-9543-d9ed3665ca49"
					lineNumber="32"
					variable="queueToCheckSingle">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						disabled="false"
						id="82298b9c-a0b9-4254-b035-37fac33e449a"
						lineNumber="33">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="037ebd94-835b-48de-bb0d-3d6dfa443da2"
							serviceId="nabu.frameworks.tasks.utils.queue.finalize"
							resultName="result3e2b24a3321c417095f25b26b0c34e12"
							temporaryMapping="true"
							x="13"
							y="128"
							invocationOrder="0"
							target="nabu.frameworks.tasks.artifacts.queueFinalizer"
							asynchronous="true"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="5da77eca-041b-44a1-b335-416beb681ff2"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>queueToCheckSingle/provider/connectionId</from>
							<to>connectionId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="6d62322c-88f9-49d1-9c50-02ad3a99d5cc"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>transactionId</from>
							<to>transactionId</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="d1108e78-cd54-42b7-b6a5-0fffa7feadc3"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>queueToCheckSingle/queue</from>
							<to>queue</to>
						</steps>
					</steps>
				</steps>
				<query>queuesToCheck</query>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Drop the list (also dropped in beginning in case of errors)"
					disabled="false"
					id="aa846e52-612c-46ad-ac82-75f4fadc3458"
					lineNumber="34">
				<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
						disabled="false"
						id="7c435e49-b042-46a2-a996-5f3a3d1450d0"
						path="queuesToCheck" xsi:nil="true"/>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Catch"
					disabled="false"
					id="f76003d4-8e9c-459f-b3a2-717ebeb1c075"
					lineNumber="35">
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
				comment="Sleep"
				disabled="false"
				id="944d39b5-a9f6-415f-9174-6bb4aeca7b04"
				lineNumber="36">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Get one minute in future (longest wait)"
					disabled="false"
					id="01af70db-e0b6-4905-a63a-92899fec7a0e"
					lineNumber="37">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="e6491060-129a-4f73-b529-5dc8bd012162"
						serviceId="nabu.utils.Date.increment"
						resultName="resultd0a688b3b9904a7ca46a6b87f8ba7bdd"
						temporaryMapping="true"
						x="77"
						y="67"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="c11096ab-b539-440f-9286-4942c4099441"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>1</from>
						<to>increment</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="a93b71b4-cfa8-492b-838f-69162c825a59"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>MINUTES</from>
						<to>unit</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="6a206506-1ef5-43c3-81ec-557df2f6e545"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>resultd0a688b3b9904a7ca46a6b87f8ba7bdd/date</from>
					<to>scheduled</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					disabled="false"
					id="7642280e-2d5f-4952-b2cf-dc5fc349ac37"
					label="nearestSchedule == null || scheduled &lt; nearestSchedule"
					lineNumber="38">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="3897d3a8-6325-4cb9-9578-220c95a3c5d8"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>scheduled</from>
					<to>nearestSchedule</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Check if someone interrupted us while we were running and check diff"
					disabled="false"
					id="76eef271073f4854ae6978b58cc6f1c1"
					lineNumber="39">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="0dd3ec521aad44b795c52de4301cec7f"
						serviceId="nabu.utils.Runtime.interrupted"
						resultName="result9c4dc6ef4c604920a32c7ae1cb6541b3"
						temporaryMapping="true"
						x="63"
						y="92"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="fa3a857d883443b2b541f62594fb565e"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>nabu.frameworks.tasks.artifacts.taskChecker</from>
						<to>artifactId</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="94457723d150484ea1038008dd90696f"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result9c4dc6ef4c604920a32c7ae1cb6541b3/interrupted</from>
					<to>interrupted</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="3cd1cf5e-b061-4315-9064-b899bb3c3838"
						serviceId="nabu.utils.Date.diff"
						resultName="result641a26cd582c4c34b2b882bc1c7564e3"
						temporaryMapping="true"
						x="72"
						y="185"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="69add3a1-66e6-416e-ae14-5a026bb34836"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>MILLISECONDS</from>
						<to>unit</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="970d722b-084e-49b4-b437-9c91bada04e3"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>nearestSchedule</from>
						<to>end</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="58cafae6-a882-483c-8c3f-4fca9949a3be"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>result641a26cd582c4c34b2b882bc1c7564e3/diff</from>
					<to>amountOfMs</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
						disabled="false"
						id="be252ad5-e895-431c-80dd-625b2d898877"
						path="scheduled" xsi:nil="true"/>
				<steps xsi:type="be.nabu.libs.services.vm.step.Drop"
						disabled="false"
						id="c4b63f0f-8faa-4ad5-9658-060fd81fbd31"
						path="nearestSchedule" xsi:nil="true"/>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="40b18e98-738e-467c-b5c5-e78a71cb8c4f"
						mask="false"
						optional="false"
						fixedValue="false">
					<from>nearestSchedule</from>
					<to>lastScheduled</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map"
					comment="Sleep, if you publish something, this should automatically wake up"
					disabled="false"
					id="e07a80f0-e77a-4627-b840-4241c469c20f"
					label="!interrupted &amp;&amp; amountOfMs &gt; 0"
					lineNumber="40">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
						disabled="false"
						id="a295280e-308a-4db2-b8ae-ccc310d29664"
						serviceId="nabu.utils.Server.sleep"
						resultName="resultcf8a11edf6044bbabfc76adc2f07e713"
						temporaryMapping="true"
						x="72"
						y="98"
						invocationOrder="0"
						asynchronous="false"
						recache="false">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="de37e09e-aee6-4ad8-a2c2-b2b4b4204bae"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>MILLISECONDS</from>
						<to>unit</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="47ec4e1a-76bd-4e99-8dee-23cf9cb92c5f"
							mask="false"
							optional="false"
							fixedValue="true">
						<from>=amountOfMs + 1</from>
						<to>amount</to>
					</steps>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Catch"
					disabled="false"
					id="b6b3ea39-f948-4aa9-bf3d-66127ca4a8f5"
					lineNumber="41">
			</steps>
		</steps>
		<query>true</query>
	</steps>
</sequence>