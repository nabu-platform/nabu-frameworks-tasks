<sequence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" disabled="false" id="26ee3fa1-7ea7-46c4-ab94-607a20b08957">
	<steps xsi:type="be.nabu.libs.services.vm.step.Map" disabled="false" label="!input/targets" comment="Add $any, the server name and the server group" id="89df3f61fbc940cb8736369f000c18a7">
		<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="e1c527d0cdec41c2896854700159fdf2" fixedValue="true" optional="false" mask="false">
			<from>$any</from>
			<to>input/targets[0]</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="6e1acaea-efd6-484a-b82b-3795fbd3a50d" serviceId="nabu.utils.Server.getServerName" resultName="result9499befa2b8f40779425dcb12af9abf8" invocationOrder="0" temporaryMapping="true" y="63" x="4">
			<asynchronous>false</asynchronous>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="e6d3c4cc-5509-4bdc-bf48-7d046020bb0c" serviceId="nabu.utils.Server.getServerGroup" resultName="result45010fae5e634d1c9afde25e20385020" invocationOrder="0" temporaryMapping="true" y="162" x="59">
			<asynchronous>false</asynchronous>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="913d28b5-51ae-42c1-8e17-e3e93790c2d4" fixedValue="false" optional="false" mask="false">
			<from>result9499befa2b8f40779425dcb12af9abf8/server</from>
			<to>input/targets[1]</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="c6cc4afc-15e1-4b9a-9569-6fb7c75a8774" fixedValue="false" optional="false" mask="false">
			<from>result45010fae5e634d1c9afde25e20385020/group</from>
			<to>input/targets[2]</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map" disabled="false" label="input/transactionId = null" id="da207ea8-963d-4c75-87d2-46daa7933eb7">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="14d20b61-6bfc-401d-a5da-4e51346d1513" serviceId="nabu.utils.Transaction.start" resultName="result5061d92f1c7f4588a566e41928d678d0" invocationOrder="0" temporaryMapping="true" y="52" x="29">
			<asynchronous>false</asynchronous>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="98d5049a-4669-499a-b3ba-82ed2833dfb6" fixedValue="false" optional="false" mask="false">
			<from>result5061d92f1c7f4588a566e41928d678d0/transactionId</from>
			<to>input/transactionId</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="b60e7b2c-8f63-4441-b7d4-694454a7fdf3" fixedValue="true" optional="false" mask="false">
			<from>true</from>
			<to>manage</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map" disabled="false" comment="Set lock name and default executor" id="cfc08f97-30aa-4903-816e-0734f1aa1469">
		<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="c687afcd-d39d-4c67-9d64-27e68e5f3acb" fixedValue="true" optional="false" mask="false">
			<from>="subscribe.queue." + input/queue/name</from>
			<to>lockName</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="3cf342ba-f8f9-4f32-947a-bfc0c0b1561e" fixedValue="true" optional="true" mask="false">
			<from>nabu.frameworks.tasks.artifacts.sharedExecutor</from>
			<to>input/queue/executor</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Switch" disabled="false" id="53a205ef-d977-42d7-93b4-d1309cb790a0" query="input/queue/concurrency">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map" disabled="false" label="0" comment="We have a serial queue, we need a cluster lock" id="ba6f0a66-84c3-412f-a776-98c7496ec582">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="9037227b-0501-4590-a000-55e3d17c58ef" serviceId="nabu.utils.Lock.tryLock" resultName="result1e361f6a10c94723b12f5319cdfa6f00" invocationOrder="0" temporaryMapping="true" y="94" x="46">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="84da3a54-786e-4f8c-9763-93dc05838b3b" fixedValue="true" optional="false" mask="false">
					<from>false</from>
					<to>local</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="354254be-a6a3-4fad-84bf-4db3f50059e2" fixedValue="false" optional="false" mask="false">
					<from>lockName</from>
					<to>name</to>
				</steps>
				<asynchronous>false</asynchronous>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="eea82157-f22b-4d82-ab6f-8494ab8cf07a" fixedValue="false" optional="false" mask="false">
				<from>result1e361f6a10c94723b12f5319cdfa6f00/locked</from>
				<to>canSubscribe</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="f163bf5d-a385-4ede-90fc-432fcc8feb88" fixedValue="true" optional="false" mask="false">
				<from>1</from>
				<to>concurrency</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="6cc1a876-20f9-4df0-b75d-811c5015e72e" fixedValue="false" optional="false" mask="false">
				<from>lockName</from>
				<to>clusterLock</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map" disabled="false" id="d5a4e191-d092-4408-a97f-12191a702283">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="76ea3ad5-db85-4cd8-8e61-701e28b666b5" fixedValue="true" optional="false" mask="false">
				<from>true</from>
				<to>canSubscribe</to>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="2d46d374-f5e1-46f9-be77-0323334c2e12" fixedValue="false" optional="false" mask="false">
				<from>input/queue/concurrency</from>
				<to>concurrency</to>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Sequence" disabled="false" label="canSubscribe" comment="Make sure we unlock the cluster lock" id="4236cc34-044a-4869-a694-d96b842497ed">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map" disabled="true" label="input/queue/concurrency = 0" comment="If it is a serial queue and we have the lock, roll back any running tasks by other servers" id="c1bd17f9-acf9-4084-a74f-e35049e36cc1">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="c10586ed-c001-4e8c-8b42-680b0e6acb1a" serviceId="nabu.frameworks.tasks.utils.queue.rollback" resultName="result97ab4d808033489e8ac14ae3e8b72df8" invocationOrder="1" temporaryMapping="true" y="180" x="236">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="b687447d-04ef-44e6-9809-8c3d7dfa2881" fixedValue="false" optional="false" mask="false">
					<from>input/queue</from>
					<to>queue</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="ace2dcb6-f082-49b2-8854-859c8b03a651" fixedValue="false" optional="false" mask="false">
					<from>input/connectionId</from>
					<to>connectionId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="32fd9534-94f4-44c6-bfdf-fa0349cfea78" fixedValue="false" optional="false" mask="false">
					<from>input/transactionId</from>
					<to>transactionId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="d9d274b5-9212-4eb7-b99f-ec4c4f793087" fixedValue="false" optional="false" mask="false">
					<from>result865471fa695a44b59d8e5bf38a384704/server</from>
					<to>notOwner</to>
				</steps>
				<asynchronous>false</asynchronous>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="3bf77682-6a7d-4532-bbe1-a7fb18f8426f" serviceId="nabu.utils.Server.getServerName" resultName="result865471fa695a44b59d8e5bf38a384704" invocationOrder="0" temporaryMapping="true" y="47" x="62">
				<asynchronous>false</asynchronous>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map" disabled="false" comment="Get amount of running tasks" id="9855a797-7b05-4483-a6b3-c6ec6c32e554">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="8816775e-f2c5-4a97-b4a4-2f902f1c71df" serviceId="nabu.frameworks.tasks.database.task.countByQueueId" resultName="result3a4da29d10ad4dce8280cf298ef00d6f" invocationOrder="1" temporaryMapping="true" y="225" x="304">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="f13b4f0d-3244-40a5-a765-314c579d1c30" fixedValue="false" optional="false" mask="false">
					<from>input/connectionId</from>
					<to>connection</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="3e71792b-b84c-4a32-b0d4-86ce4ccf9a94" fixedValue="false" optional="false" mask="false">
					<from>input/transactionId</from>
					<to>transaction</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="9219b7d7-fd69-4cc8-b020-9e574f965ec8" fixedValue="false" optional="false" mask="false">
					<from>input/queue/id</from>
					<to>parameters/queueId</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="0450af0e-0ec5-4ad8-8e7c-2ce1be9af997" fixedValue="false" optional="false" mask="false">
					<from>resulta92b243bc1864fd7bf08d3fa866f11d4/parts</from>
					<to>parameters/states</to>
				</steps>
				<asynchronous>false</asynchronous>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="b91ab2b3-6298-44d0-8df1-3f180e4c4241" serviceId="nabu.utils.String.split" resultName="resulta92b243bc1864fd7bf08d3fa866f11d4" invocationOrder="0" temporaryMapping="true" y="60" x="80">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="524dc6f4-d1bd-4044-bd61-565dc636e40e" fixedValue="true" optional="false" mask="false">
					<from>WAITING,RUNNING</from>
					<to>string</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="60a9dee3-5afd-4bce-a212-95a9f5fc3198" fixedValue="true" optional="false" mask="false">
					<from>,</from>
					<to>separator</to>
				</steps>
				<asynchronous>false</asynchronous>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="a063b542-94f9-452e-b8f4-cdecd132ccd6" fixedValue="false" optional="false" mask="false">
				<from>result3a4da29d10ad4dce8280cf298ef00d6f/results[0]/total</from>
				<to>amountOfRunningTasks</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Map" disabled="false" label="amountOfRunningTasks &gt; 0" id="52006814-3899-44eb-a31d-a8dd83745c6f">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="5a3b76b5-4223-4cdb-8c4b-ae85e216efd6" fixedValue="true" optional="false" mask="false">
				<from>=concurrency - amountOfRunningTasks</from>
				<to>concurrency</to>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Sequence" disabled="false" label="concurrency &gt; 0" comment="Only proceed if we want more tasks" id="8e4ac11e-6135-48e5-9f7c-49e58fb7034f">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map" disabled="false" label="input/localLock != null" comment="We already have a local lock, no need for a new lock and only one task" id="ffe1fa41-48a6-4ed8-b2bd-306bdae382cf">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="e6206a23-db25-4156-a4ea-1d2a1547df0f" fixedValue="true" optional="false" mask="false">
					<from>1</from>
					<to>concurrency</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Map" disabled="false" comment="Poll tasks for the queue" id="60f52202-e45b-4edc-bb6b-d68beafb4b99">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="a7c37664-b00c-4eeb-b92e-875e98b8245f" serviceId="nabu.frameworks.tasks.utils.queue.poll" resultName="result42f527826a0f4e9aae5139b28f6443f5" invocationOrder="0" temporaryMapping="true" y="125" x="70">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="c87d8e0a-4f2d-45b7-911a-6f3c60dda1d1" fixedValue="false" optional="false" mask="false">
						<from>concurrency</from>
						<to>limit</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="cd36f3ae-3cb5-4434-b75f-91aeaf67c935" fixedValue="false" optional="false" mask="false">
						<from>input/targets</from>
						<to>targets</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="c362f561-a73c-4815-aa56-4580fdafbff6" fixedValue="false" optional="false" mask="false">
						<from>input/taskType</from>
						<to>taskType</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="7b40d6fd-050a-4324-a2a3-ab6cbd3340e1" fixedValue="false" optional="false" mask="false">
						<from>input/connectionId</from>
						<to>connectionId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="f1a7d2e4-8827-4810-9fce-b75e0162cfde" fixedValue="false" optional="false" mask="false">
						<from>input/transactionId</from>
						<to>transactionId</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="789b05a0-edb3-4f3c-bfcd-8aad149701ef" fixedValue="false" optional="false" mask="false">
						<from>input/queue</from>
						<to>queue</to>
					</steps>
					<asynchronous>false</asynchronous>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="baac70d1-d2e0-42e2-aeb9-c6b3f43aee2c" fixedValue="false" optional="false" mask="false">
					<from>result42f527826a0f4e9aae5139b28f6443f5/tasks</from>
					<to>tasks</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="f45f5807-339e-4663-a840-8fdb10782c39" fixedValue="true" optional="false" mask="false">
					<from>0</from>
					<to>taskIndex</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="a61e0fc0-219e-4c93-84c2-b3db5d5cd7b1" serviceId="nabu.utils.List.size" resultName="result6c7b6c39917845ee82d9ec9a8e8afd87" invocationOrder="1" temporaryMapping="true" y="246" x="202">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="d74d878d-1899-4975-b351-f08109739014" fixedValue="false" optional="false" mask="false">
						<from>result42f527826a0f4e9aae5139b28f6443f5/tasks</from>
						<to>list</to>
					</steps>
					<asynchronous>false</asynchronous>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="5ba6bccf-5b16-4c63-b682-e99b7ee64d69" fixedValue="false" optional="false" mask="false">
					<from>result6c7b6c39917845ee82d9ec9a8e8afd87/size</from>
					<to>amountOfTasks</to>
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.For" disabled="false" label="amountOfTasks &gt; 0" id="0909cf3a-e680-4e45-b95e-1c778e3b2fae" variable="current">
				<steps xsi:type="be.nabu.libs.services.vm.step.Break" disabled="false" label="taskIndex &gt;= amountOfTasks" comment="Stop if we have no more tasks left" id="d7ed6891-f1aa-48d1-84e0-cba22e716872">
					<count>1</count>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Sequence" disabled="false" label="canSubscribe" id="80808c81-eb6b-4a35-b4e2-ee9a40af4ed1">
					<steps xsi:type="be.nabu.libs.services.vm.step.Sequence" disabled="false" comment="Update task to WAITING" id="0d814432-9417-480e-aa4b-5c67bbeac1db" transactionVariable="waitingTransactionId">
						<steps xsi:type="be.nabu.libs.services.vm.step.Map" disabled="false" comment="Set to waiting" id="ad3cf9bd-4806-408f-a803-211d5c919c5d">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="3095c203-47da-4e66-9859-8f667a7f4e41" serviceId="nabu.frameworks.tasks.database.task.pickup" resultName="resultfcd0f6e8ace34345971fe60c4a056852" invocationOrder="1" temporaryMapping="true" y="171" x="328">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="c214800d-11b5-4dd4-aa7f-36e4cae4aacc" fixedValue="false" optional="false" mask="false">
									<from>input/connectionId</from>
									<to>connection</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="7e8dca40-3566-4b5f-a105-7d7cbcb1e85d" fixedValue="false" optional="false" mask="false">
									<from>waitingTransactionId</from>
									<to>transaction</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="c40319ed-743e-40b1-8cb6-57810850f1dc" fixedValue="false" optional="false" mask="false">
									<from>tasks[/taskIndex]/id</from>
									<to>parameters[0]/id</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="069cdb01-40c4-4a62-a0b5-8ce21c010a42" fixedValue="false" optional="false" mask="false">
									<from>resultbd8bb666d22548938098668c33b51228/server</from>
									<to>parameters[0]/owner</to>
								</steps>
								<asynchronous>false</asynchronous>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="85365d97-9e0c-400c-9fb1-2f280a90c9c8" serviceId="nabu.utils.Server.getServerName" resultName="resultbd8bb666d22548938098668c33b51228" invocationOrder="0" temporaryMapping="true" y="17" x="17">
								<asynchronous>false</asynchronous>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="b6744a0d-fa0d-4ab9-bdf0-2040d58a60b1" fixedValue="false" optional="false" mask="false">
								<from>resultfcd0f6e8ace34345971fe60c4a056852/rowCount</from>
								<to>waitingCount</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Map" disabled="false" label="waitingCount &gt; 0" id="e22f6400-1c26-49a1-a65c-fa50cb794af9">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="22fcef0f-3870-4ed6-b27a-114a3918b997" serviceId="nabu.frameworks.tasks.services.task.log" resultName="result28f5b46dd59c4385864672b49c955a87" invocationOrder="0" temporaryMapping="true" y="122" x="252">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="0b9a72ae-1767-44b7-b8fb-81e1816cf197" fixedValue="false" optional="false" mask="false">
									<from>input/connectionId</from>
									<to>connectionId</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="8c6867d1-79af-4046-aef9-4ab8af1b978c" fixedValue="false" optional="false" mask="false">
									<from>waitingTransactionId</from>
									<to>transactionId</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="75516683-0d3c-4ee2-bb92-d5ce1142c91e" fixedValue="false" optional="false" mask="false">
									<from>tasks[/taskIndex]/id</from>
									<to>taskId</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="31481c00-9a5c-4ffe-85b6-104927a3aca2" fixedValue="true" optional="false" mask="false">
									<from>pickup</from>
									<to>code</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="ef4449a8-e5be-4dd3-9719-4c85652050c3" fixedValue="true" optional="false" mask="false">
									<from>Picked up task for processing</from>
									<to>title</to>
								</steps>
								<asynchronous>false</asynchronous>
							</steps>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Map" disabled="false" label="waitingCount &gt; 0" comment="Execute the task and increment taskIndex" id="d3322a32-793d-432e-9707-fe686906ee1f">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="556236bc-3558-4226-8a3f-98250f9d427f" serviceId="nabu.frameworks.tasks.utils.task.execute" resultName="result9f44565aab164352a7db2e1e7e537e8d" invocationOrder="0" temporaryMapping="true" y="15" x="13">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="0b8bc744-f3fb-4889-aca2-eeb39104df76" fixedValue="false" optional="false" mask="false">
								<from>tasks[/taskIndex]</from>
								<to>task</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="951a3f4a-f454-41d6-aac3-75582562219f" fixedValue="false" optional="false" mask="false">
								<from>currentLockName</from>
								<to>localLock</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="03bb749d-b8aa-4aec-b49b-63fb6c35615f" fixedValue="false" optional="false" mask="false">
								<from>input/connectionId</from>
								<to>connectionId</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="34d5c22c-0971-4b7e-b142-feaa83ac9f3f" fixedValue="false" optional="false" mask="false">
								<from>clusterLock</from>
								<to>clusterLock</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="8b1a0fa7-58cd-4d65-80c6-51c4e4f4fa2b" fixedValue="false" optional="false" mask="false">
								<from>input/queue</from>
								<to>queue</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="eb7f926f-eca8-4858-9895-ec6291ef1185" fixedValue="false" optional="false" mask="false">
								<from>input/targets</from>
								<to>targets</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="c31a28de-9a2e-4316-8e78-a465a1b4eea8" fixedValue="false" optional="false" mask="false">
								<from>input/taskType</from>
								<to>taskType</to>
							</steps>
							<asynchronous>true</asynchronous>
							<target>=input/queue/executor</target>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="7a608935-3f80-41e1-852c-2527ee728cae" serviceId="nabu.utils.List.add" resultName="result32593c0358734b2898540f00cfbd842b" invocationOrder="0" temporaryMapping="true" y="202" x="78">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="152e53f9-f1cc-4b72-94cf-927896411cf3" fixedValue="false" optional="false" mask="false">
								<from>output/tasks</from>
								<to>list</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="ab9b3e7a-c729-4014-8f26-d675cc44e3e8" fixedValue="false" optional="false" mask="false">
								<from>tasks[/taskIndex]</from>
								<to>object</to>
							</steps>
							<asynchronous>false</asynchronous>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="6d5aceb2-1d17-4685-bb8a-91ebcd210bf2" fixedValue="false" optional="false" mask="false">
							<from>result32593c0358734b2898540f00cfbd842b/list</from>
							<to>output/tasks</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="9f07ef47-9b3f-4d0d-9585-a90a2338097a" fixedValue="true" optional="false" mask="false">
							<from>=taskIndex + 1</from>
							<to>taskIndex</to>
						</steps>
					</steps>
				</steps>
				<query>concurrency</query>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Finally" disabled="false" id="18f313dc-9325-4a5f-8797-2a0731c04a86">
			<steps xsi:type="be.nabu.libs.services.vm.step.Map" disabled="false" label="clusterLock != null" comment="Release the cluster lock" id="00aa251e29e94008a90cf4dd214c219f">
				<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="9fb85a8221864f67be7a290f2efef366" serviceId="nabu.utils.Lock.unlock" resultName="result9e46b3ae770243308a1fcf118d408830" invocationOrder="0" temporaryMapping="true" y="108" x="36">
					<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="4bd646af65c9454291d59ab99dabd330" fixedValue="true" optional="false" mask="false">
						<from>false</from>
						<to>local</to>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="cc13883b-c440-430b-af3d-6759db7d5b4d" fixedValue="false" optional="false" mask="false">
						<from>clusterLock</from>
						<to>name</to>
					</steps>
					<asynchronous>false</asynchronous>
				</steps>
			</steps>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Map" disabled="false" label="manage" id="f2646543-b8ab-4322-a13d-23056cbbaeac">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="bc5c5f0e-6474-4588-aee6-14541c01669e" serviceId="nabu.utils.Transaction.commit" resultName="resultb5de570bbfa946bdbb7a796c779d9465" invocationOrder="0" temporaryMapping="true" y="66" x="66">
			<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="d35c56ac-7739-4bf8-88b8-bb87a86cca85" fixedValue="false" optional="false" mask="false">
				<from>input/transactionId</from>
				<to>transactionId</to>
			</steps>
			<asynchronous>false</asynchronous>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Catch" disabled="false" id="b2a455da-3c0f-4777-b462-2a2c29945b61" variable="exception">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map" disabled="false" label="manage" id="2b0819a8277e40df8f0faaefbb689e69">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke" disabled="false" id="19411fd4-b5a0-490f-9ce4-a3abfee1158c" serviceId="nabu.utils.Transaction.rollback" resultName="result929732ee1d7445c4ac10a67717aa7017" invocationOrder="0" temporaryMapping="true" y="23" x="22">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link" disabled="false" id="59dbb8cb-9569-40a3-85a4-462181040d52" fixedValue="false" optional="false" mask="false">
					<from>input/transactionId</from>
					<to>transactionId</to>
				</steps>
				<asynchronous>false</asynchronous>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Throw" disabled="false" id="3c30a983-c6ce-4d88-9a50-9e79c602483e" message="=exception" xsi:nil="true"/>
	</steps>
</sequence>